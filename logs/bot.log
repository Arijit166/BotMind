{"level":"info","message":"🚀 Starting WhatsApp Bot...","module":"Main","timestamp":"2025-08-29T15:47:26.988Z"}
{"level":"info","message":"📋 Loaded config - Owner: Arijit (916289610827)","module":"Main","timestamp":"2025-08-29T15:47:26.991Z"}
{"level":"info","message":"🚀 Initializing WhatsApp Bot...","module":"Bot","timestamp":"2025-08-29T15:47:26.993Z"}
{"level":"info","message":"📋 Bot Name: WhatsApp AI Bot","module":"Bot","timestamp":"2025-08-29T15:47:26.994Z"}
{"level":"info","message":"👤 Owner: Arijit (916289610827)","module":"Bot","timestamp":"2025-08-29T15:47:26.995Z"}
{"level":"info","message":"🤖 AI Model: gemini-2.5-flash","module":"Bot","timestamp":"2025-08-29T15:47:26.996Z"}
{"level":"info","message":"✅ Configuration validation passed","module":"Bot","timestamp":"2025-08-29T15:47:26.997Z"}
{"level":"info","message":"🔧 Initializing state manager...","module":"Bot","timestamp":"2025-08-29T15:47:26.998Z"}
{"level":"info","message":"🔧 Initializing bot state manager...","module":"BotStateManager","timestamp":"2025-08-29T15:47:26.999Z"}
{"level":"info","message":"No DATABASE_URL found. Using file system for state management.","module":"BotStateManager","timestamp":"2025-08-29T15:47:27.000Z"}
{"level":"info","message":"📝 Created new state file with defaults (fallback).","module":"BotStateManager","timestamp":"2025-08-29T15:47:27.012Z"}
{"currentState":{"activeSince":"2025-08-29T15:47:26.992Z","isActive":true,"lastToggled":"2025-08-29T15:47:26.992Z","rateLimit":{"cooldownMessages":["🐌 Slow down there! Please wait a moment before sending another message.","⏳ You're sending messages a bit too quickly. Take a breather!","🛑 Hold on! Please wait a few seconds before your next message.","💨 Whoa, slow down! Let's chat at a more relaxed pace."],"enabled":true,"lastReset":"2025-08-29T15:47:26.992Z","maxMessagesPerHour":100,"maxMessagesPerMinute":10,"requestCounts":{}},"settings":{"maxResponseLength":1000,"mentionRequired":true,"respondToGroups":true,"typingIndicator":true},"statistics":{"commandsProcessed":0,"errorsEncountered":0,"groupChats":0,"lastRestart":"2025-08-29T15:47:26.992Z","privateChats":0},"toggledBy":null,"totalMessages":0,"version":"1.0.0"},"level":"info","message":"✅ Bot state manager initialized successfully","module":"BotStateManager","storageMode":"File System Only","timestamp":"2025-08-29T15:47:27.014Z"}
{"level":"info","message":"📚 Initializing history manager...","module":"Bot","timestamp":"2025-08-29T15:47:27.016Z"}
{"level":"info","message":"🔧 Initializing history manager...","module":"HistoryManager","timestamp":"2025-08-29T15:47:27.017Z"}
{"level":"info","maxContextLength":20,"maxMessagesPerChat":100,"message":"✅ History manager initialized successfully","module":"HistoryManager","timestamp":"2025-08-29T15:47:27.018Z"}
{"level":"info","message":"🛡️ Initializing bot guard...","module":"Bot","timestamp":"2025-08-29T15:47:27.018Z"}
{"level":"info","message":"🧠 Initializing Gemini AI client...","module":"Bot","timestamp":"2025-08-29T15:47:27.019Z"}
{"level":"info","message":"✅ Gemini client initialized successfully","module":"GeminiClient","timestamp":"2025-08-29T15:47:27.021Z"}
{"level":"info","message":"📱 Initializing WhatsApp client...","module":"Bot","timestamp":"2025-08-29T15:47:27.022Z"}
{"level":"info","message":"💬 Initializing message handlers...","module":"Bot","timestamp":"2025-08-29T15:47:27.024Z"}
{"level":"info","message":"✅ Bot initialization completed successfully","module":"Bot","timestamp":"2025-08-29T15:47:27.025Z"}
{"level":"info","message":"🚀 Starting WhatsApp Bot...","module":"Bot","timestamp":"2025-08-29T15:47:27.026Z"}
{"level":"info","message":"🔗 Initializing WhatsApp connection...","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:27.027Z"}
{"level":"info","message":"📱 Using WhatsApp Web v2.3000.1023223821, isLatest: true","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:27.292Z"}
{"level":"info","message":"✅ WhatsApp client initialized successfully","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:27.364Z"}
{"level":"info","message":"✅ Bot started successfully","module":"Bot","timestamp":"2025-08-29T15:47:27.364Z"}
{"level":"info","message":"🤖 Bot is ACTIVE","module":"Bot","timestamp":"2025-08-29T15:47:27.365Z"}
{"level":"info","message":"🔄 Connecting to WhatsApp...","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:27.370Z"}
{"level":"info","message":"🌐 Web server listening on port 3000 (for Render health checks)","module":"Main","timestamp":"2025-08-29T15:47:27.371Z"}
{"level":"info","message":"📱 QR Code generated (attempt 1/5)","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:28.553Z"}
{"level":"info","maxAttempts":5,"message":"📱 QR Code generated (attempt 1)","module":"Bot","timestamp":"2025-08-29T15:47:28.591Z"}
{"level":"info","message":"🔌 Disconnected from WhatsApp","module":"WhatsAppClient","reason":"Restart Required","shouldReconnect":true,"timestamp":"2025-08-29T15:47:35.899Z"}
{"level":"warn","message":"📴 WhatsApp disconnected","module":"Bot","reason":515,"shouldReconnect":true,"timestamp":"2025-08-29T15:47:35.900Z"}
{"level":"info","message":"🔄 Attempting to reconnect (1/5) in 5000ms...","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:35.900Z"}
{"level":"info","message":"🔗 Initializing WhatsApp connection...","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:40.903Z"}
{"level":"info","message":"📱 Using WhatsApp Web v2.3000.1023223821, isLatest: true","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:41.109Z"}
{"level":"info","message":"✅ WhatsApp client initialized successfully","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:41.129Z"}
{"level":"info","message":"🔄 Connecting to WhatsApp...","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:41.130Z"}
{"id":"916289610827:49@s.whatsapp.net","level":"info","message":"✅ Successfully connected to WhatsApp!","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:43.836Z","user":"916289610827:49@s.whatsapp.net"}
{"level":"info","message":"🎉 WhatsApp connected successfully!","module":"Bot","timestamp":"2025-08-29T15:47:43.838Z","user":"916289610827:49@s.whatsapp.net"}
{"level":"info","message":"📤 Startup notification sent to owner","module":"Bot","timestamp":"2025-08-29T15:47:45.321Z"}
{"from":"916289610827@s.whatsapp.net","hasText":false,"level":"info","message":"📨 Message received","messageId":"B1D6E6756C241E8B1FA61570E8DA4E18","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:55.530Z","type":"unknown"}
{"from":"916289610827@s.whatsapp.net","hasText":false,"level":"info","message":"📨 Message received","messageId":"4946EEC06F6EC1E5364DC5F7CAD7D311","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:55.533Z","type":"unknown"}
{"from":"916289610827@s.whatsapp.net","hasText":false,"level":"info","message":"📨 Message received","messageId":"3EB09BA7CD18499233DD23","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:55.534Z","type":"unknown"}
{"from":"916289610827@s.whatsapp.net","hasText":false,"level":"info","message":"📨 Message received","messageId":"CAD15CE0A1D21AB469D8E646264A6A81","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:55.535Z","type":"unknown"}
{"from":"916289610827@s.whatsapp.net","hasText":false,"level":"info","message":"📨 Message received","messageId":"D07815BD7F8F0021E0075C5E66B777F6","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:55.536Z","type":"unknown"}
{"from":"916289610827@s.whatsapp.net","hasText":false,"level":"info","message":"📨 Message received","messageId":"54F28C84734C0B7E9063C624B20B5C5C","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:55.538Z","type":"unknown"}
{"from":"916289610827@s.whatsapp.net","hasText":false,"level":"info","message":"📨 Message received","messageId":"E438F3DFFF0BB2DF37B442992329E58E","module":"WhatsAppClient","timestamp":"2025-08-29T15:47:55.539Z","type":"unknown"}
{"level":"info","message":"📴 Received SIGINT, shutting down gracefully...","module":"Main","timestamp":"2025-08-29T15:48:36.894Z"}
{"level":"info","message":"🔄 Shutting down bot...","module":"Bot","timestamp":"2025-08-29T15:48:36.897Z"}
{"level":"info","message":"🔌 Disconnecting from WhatsApp...","module":"WhatsAppClient","timestamp":"2025-08-29T15:48:36.898Z"}
{"level":"info","message":"🔌 Disconnected from WhatsApp","module":"WhatsAppClient","reason":"Unknown (undefined)","shouldReconnect":true,"timestamp":"2025-08-29T15:48:36.899Z"}
{"level":"info","message":"🔄 Attempting to reconnect (1/5) in 5000ms...","module":"WhatsAppClient","timestamp":"2025-08-29T15:48:36.899Z"}
{"level":"info","message":"🌐 Web server closed.","module":"Main","timestamp":"2025-08-29T15:48:36.900Z"}
{"level":"info","message":"✅ Disconnected from WhatsApp","module":"WhatsAppClient","timestamp":"2025-08-29T15:48:36.901Z"}
{"level":"info","message":"🔄 Shutting down Gemini client...","module":"GeminiClient","timestamp":"2025-08-29T15:48:36.902Z"}
{"level":"info","message":"✅ Gemini client shutdown complete","module":"GeminiClient","timestamp":"2025-08-29T15:48:36.903Z"}
{"level":"info","message":"🔄 Shutting down bot guard...","module":"BotGuard","timestamp":"2025-08-29T15:48:36.903Z"}
{"level":"info","message":"✅ Bot guard shutdown complete","module":"BotGuard","timestamp":"2025-08-29T15:48:36.904Z"}
{"level":"info","message":"🔄 Shutting down history manager...","module":"HistoryManager","timestamp":"2025-08-29T15:48:36.904Z"}
{"averageMessagesPerChat":0,"configuration":{"cleanupInterval":86400000,"maxContextLength":20,"maxMessagesPerChat":100},"enabled":true,"level":"info","maxChatSize":0,"memoryUsage":0,"message":"📊 Final history statistics","minChatSize":0,"module":"HistoryManager","timestamp":"2025-08-29T15:48:36.906Z","totalChats":0,"totalMessages":0}
{"level":"info","message":"✅ History manager shutdown complete","module":"HistoryManager","timestamp":"2025-08-29T15:48:36.907Z"}
{"level":"info","message":"🔄 Shutting down state manager...","module":"BotStateManager","timestamp":"2025-08-29T15:48:36.907Z"}
{"level":"info","message":"✅ State manager shutdown complete","module":"BotStateManager","timestamp":"2025-08-29T15:48:36.914Z"}
{"level":"info","message":"🚀 Starting WhatsApp Bot...","module":"Main","timestamp":"2025-08-29T16:00:54.305Z"}
{"level":"info","message":"📋 Loaded config - Owner: Arijit (916289610827)","module":"Main","timestamp":"2025-08-29T16:00:54.308Z"}
{"level":"info","message":"🚀 Initializing WhatsApp Bot...","module":"Bot","timestamp":"2025-08-29T16:00:54.309Z"}
{"level":"info","message":"📋 Bot Name: WhatsApp AI Bot","module":"Bot","timestamp":"2025-08-29T16:00:54.309Z"}
{"level":"info","message":"👤 Owner: Arijit (916289610827)","module":"Bot","timestamp":"2025-08-29T16:00:54.310Z"}
{"level":"info","message":"🤖 AI Model: gemini-2.5-flash","module":"Bot","timestamp":"2025-08-29T16:00:54.310Z"}
{"level":"info","message":"✅ Configuration validation passed","module":"Bot","timestamp":"2025-08-29T16:00:54.310Z"}
{"level":"info","message":"🔧 Initializing state manager...","module":"Bot","timestamp":"2025-08-29T16:00:54.311Z"}
{"level":"info","message":"🔧 Initializing bot state manager...","module":"BotStateManager","timestamp":"2025-08-29T16:00:54.312Z"}
{"level":"info","message":"No DATABASE_URL found. Using file system for state management.","module":"BotStateManager","timestamp":"2025-08-29T16:00:54.312Z"}
{"level":"info","message":"📂 State loaded from file (fallback).","module":"BotStateManager","timestamp":"2025-08-29T16:00:54.333Z"}
{"currentState":{"activeSince":"2025-08-29T15:47:26.992Z","isActive":true,"lastToggled":"2025-08-29T15:47:26.992Z","rateLimit":{"cooldownMessages":["🐌 Slow down there! Please wait a moment before sending another message.","⏳ You're sending messages a bit too quickly. Take a breather!","🛑 Hold on! Please wait a few seconds before your next message.","💨 Whoa, slow down! Let's chat at a more relaxed pace."],"enabled":true,"lastReset":"2025-08-29T15:47:26.992Z","maxMessagesPerHour":100,"maxMessagesPerMinute":10,"requestCounts":{}},"settings":{"maxResponseLength":1000,"mentionRequired":true,"respondToGroups":true,"typingIndicator":true},"statistics":{"commandsProcessed":0,"errorsEncountered":0,"groupChats":0,"lastRestart":"2025-08-29T15:47:26.992Z","privateChats":0},"toggledBy":null,"totalMessages":0,"version":"1.0.0"},"level":"info","message":"✅ Bot state manager initialized successfully","module":"BotStateManager","storageMode":"File System Only","timestamp":"2025-08-29T16:00:54.334Z"}
{"level":"info","message":"📚 Initializing history manager...","module":"Bot","timestamp":"2025-08-29T16:00:54.336Z"}
{"level":"info","message":"🔧 Initializing history manager...","module":"HistoryManager","timestamp":"2025-08-29T16:00:54.337Z"}
{"level":"info","maxContextLength":20,"maxMessagesPerChat":100,"message":"✅ History manager initialized successfully","module":"HistoryManager","timestamp":"2025-08-29T16:00:54.337Z"}
{"level":"info","message":"🛡️ Initializing bot guard...","module":"Bot","timestamp":"2025-08-29T16:00:54.338Z"}
{"level":"info","message":"🧠 Initializing Gemini AI client...","module":"Bot","timestamp":"2025-08-29T16:00:54.339Z"}
{"level":"info","message":"✅ Gemini client initialized successfully","module":"GeminiClient","timestamp":"2025-08-29T16:00:54.340Z"}
{"level":"info","message":"📱 Initializing WhatsApp client...","module":"Bot","timestamp":"2025-08-29T16:00:54.341Z"}
{"level":"info","message":"💬 Initializing message handlers...","module":"Bot","timestamp":"2025-08-29T16:00:54.342Z"}
{"level":"info","message":"✅ Bot initialization completed successfully","module":"Bot","timestamp":"2025-08-29T16:00:54.343Z"}
{"level":"info","message":"🚀 Starting WhatsApp Bot...","module":"Bot","timestamp":"2025-08-29T16:00:54.343Z"}
{"level":"info","message":"🔗 Initializing WhatsApp connection...","module":"WhatsAppClient","timestamp":"2025-08-29T16:00:54.344Z"}
{"level":"info","message":"📱 Using WhatsApp Web v2.3000.1023223821, isLatest: true","module":"WhatsAppClient","timestamp":"2025-08-29T16:00:54.637Z"}
{"level":"info","message":"✅ WhatsApp client initialized successfully","module":"WhatsAppClient","timestamp":"2025-08-29T16:00:54.651Z"}
{"level":"info","message":"✅ Bot started successfully","module":"Bot","timestamp":"2025-08-29T16:00:54.652Z"}
{"level":"info","message":"🤖 Bot is ACTIVE","module":"Bot","timestamp":"2025-08-29T16:00:54.652Z"}
{"level":"info","message":"🔄 Connecting to WhatsApp...","module":"WhatsAppClient","timestamp":"2025-08-29T16:00:54.659Z"}
{"level":"info","message":"🌐 Web server listening on port 3000 (for Render health checks)","module":"Main","timestamp":"2025-08-29T16:00:54.661Z"}
{"id":"916289610827:49@s.whatsapp.net","level":"info","message":"✅ Successfully connected to WhatsApp!","module":"WhatsAppClient","timestamp":"2025-08-29T16:00:56.213Z","user":"Joy~❤️"}
{"level":"info","message":"🎉 WhatsApp connected successfully!","module":"Bot","timestamp":"2025-08-29T16:00:56.215Z","user":"Joy~❤️"}
{"level":"info","message":"📤 Startup notification sent to owner","module":"Bot","timestamp":"2025-08-29T16:00:56.673Z"}
{"from":"916289610827@s.whatsapp.net","hasText":false,"level":"info","message":"📨 Message received","messageId":"3FF346777E8A0C23EFC1","module":"WhatsAppClient","timestamp":"2025-08-29T16:01:03.168Z","type":"unknown"}
{"level":"info","message":"✅ Owner command detected from self-chat. Processing...","module":"Bot","timestamp":"2025-08-29T16:01:03.171Z"}
{"args":[],"command":"off","from":"916289610827@s.whatsapp.net","isOwner":true,"level":"info","message":"🔧 Processing command","module":"Bot","timestamp":"2025-08-29T16:01:03.172Z"}
{"changes":{"isActive":{"from":true,"to":false},"lastToggled":{"from":"2025-08-29T15:47:26.992Z","to":"2025-08-29T16:01:03.173Z"},"toggledBy":{"from":null,"to":"916289610827"}},"level":"info","message":"🔄 State updated in memory","module":"BotStateManager","timestamp":"2025-08-29T16:01:03.173Z"}
{"level":"info","message":"🔄 Bot deactivated","module":"Bot","timestamp":"2025-08-29T16:01:03.174Z","toggledBy":"916289610827"}
{"level":"info","message":"Bot deactivated. Initiating shutdown.","module":"Bot","timestamp":"2025-08-29T16:01:03.186Z"}
{"level":"info","message":"Handler is requesting bot shutdown...","module":"Bot","timestamp":"2025-08-29T16:01:04.201Z"}
{"level":"info","message":"🔄 Shutting down bot...","module":"Bot","timestamp":"2025-08-29T16:01:04.203Z"}
{"level":"info","message":"🔌 Disconnecting from WhatsApp...","module":"WhatsAppClient","timestamp":"2025-08-29T16:01:04.204Z"}
{"level":"info","message":"🔌 Disconnected from WhatsApp","module":"WhatsAppClient","reason":"Unknown (undefined)","shouldReconnect":true,"timestamp":"2025-08-29T16:01:04.206Z"}
{"level":"info","message":"🔄 Attempting to reconnect (1/5) in 5000ms...","module":"WhatsAppClient","timestamp":"2025-08-29T16:01:04.206Z"}
{"level":"info","message":"✅ Disconnected from WhatsApp","module":"WhatsAppClient","timestamp":"2025-08-29T16:01:04.207Z"}
{"level":"info","message":"🔄 Shutting down Gemini client...","module":"GeminiClient","timestamp":"2025-08-29T16:01:04.208Z"}
{"level":"info","message":"✅ Gemini client shutdown complete","module":"GeminiClient","timestamp":"2025-08-29T16:01:04.209Z"}
{"level":"info","message":"🔄 Shutting down bot guard...","module":"BotGuard","timestamp":"2025-08-29T16:01:04.209Z"}
{"level":"info","message":"✅ Bot guard shutdown complete","module":"BotGuard","timestamp":"2025-08-29T16:01:04.210Z"}
{"level":"info","message":"🔄 Shutting down history manager...","module":"HistoryManager","timestamp":"2025-08-29T16:01:04.211Z"}
{"averageMessagesPerChat":0,"configuration":{"cleanupInterval":86400000,"maxContextLength":20,"maxMessagesPerChat":100},"enabled":true,"level":"info","maxChatSize":0,"memoryUsage":0,"message":"📊 Final history statistics","minChatSize":0,"module":"HistoryManager","timestamp":"2025-08-29T16:01:04.212Z","totalChats":0,"totalMessages":0}
{"level":"info","message":"✅ History manager shutdown complete","module":"HistoryManager","timestamp":"2025-08-29T16:01:04.213Z"}
{"level":"info","message":"🔄 Shutting down state manager...","module":"BotStateManager","timestamp":"2025-08-29T16:01:04.214Z"}
{"level":"info","message":"✅ State manager shutdown complete","module":"BotStateManager","timestamp":"2025-08-29T16:01:04.220Z"}
